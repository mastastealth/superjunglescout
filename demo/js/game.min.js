var game=new Phaser.Game(1440,900,Phaser.AUTO,""),init=!1;window.onload=function(){function e(){game.scale.setShowAll(),game.scale.refresh()}function a(e,a,t){if(game.learnMore)game.fx.click.play(),document.getElementById("modal").classList.add("active"),document.querySelector("#modal .info").innerHTML=e[t].info,document.querySelector("#modal .info").scrollTop=0,document.querySelector("#modal .video").setAttribute("href",e[t].url),game.learnMore=!1;else{var n=game.add.sprite(e[t].pos[0]-a.animList[0][0].origin[0],e[t].pos[1]-a.animList[0][0].origin[1],"spr"+t+a.animList[0][1]);a.animList[0][0].blockInput&&(n.inputEnabled=!0);var o=n.animations.add("default");a.animList[0][0].hideOriginal&&(a.alpha=0,o.onComplete.add(function(){a.alpha=1},this)),n.anchor.setTo(.5,.5),n.animations.play("default",7,!1),game.jungle.sfx.play(a.animList[0][1]),o.killOnComplete=!0}document.querySelector("body").classList.remove("ask"),document.querySelector("body").classList.remove("hand")}function t(e){console.log("Storing animals in memory from: "+e);var a=new XMLHttpRequest;a.open("GET","assets/data/"+e+".json",!0),a.onload=function(){if(a.status>=200&&a.status<400){var t=JSON.parse(a.responseText);game.jungle[e]=t}},a.onerror=function(){},a.send()}function n(e,a){a.loopCount===e.randLoop&&e.animations.play("idleMove",7,!1)}function o(e){e.animations.play("idle",7,!0),e.randLoop=game.rnd.integerInRange(15,50)}window.addEventListener("resize",function(){e()}),document.querySelector("#modal .close").addEventListener("click",function(){document.getElementById("modal").classList.remove("active"),document.querySelector("#modal .video").setAttribute("href","")});var s=game.plugins.add(Phaser.Plugin.StateTransition);s.settings({duration:1e3,properties:{alpha:0,scale:{x:1.5,y:1.5}}});var i={},r=0;i.boot=function(e){this.game=e},i.boot.prototype={preload:function(){console.log("Booting..."),game.load.image("logoLoad","assets/images/bg/logo_load.png")},create:function(){game.stage.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.setShowAll(),game.scale.refresh(),game.initialLoad=!0,game.jungle={},game.state.start("preload"),request=new XMLHttpRequest,request.open("GET","assets/data/levels.json",!0),request.onload=function(){if(request.status>=200&&request.status<400){var e=JSON.parse(request.responseText);init||(console.log("Creating Levels"),e.levels.forEach(function(e){var d=e.transitionBg,l=e.background,m=e.name;i[m]=function(e){this.game=e},i[m].prototype={preload:function(){game.add.sprite(0,0,d);game.ambient=game.add.audio("amb",1,!0),game.ambient.play("",0,.35,!0),game.load.image("btnBack","assets/images/btn_back.png"),game.load.image("btnAsk","assets/images/btn_ask.png")},create:function(){game.add.sprite(0,0,l);game.fx=game.add.audio("sfx"),game.fx.click=game.add.audio("click");var e=game.jungle[r].creatures;for(var t in e){var i=e[t];i.sprite=game.add.sprite(i.pos[0],i.pos[1],"spr"+t),i.sprite.anchor.setTo(.5,.5),i.sprite.animList=[];var d=i.sprite.animations.add("idle",i.framesStatic),m={font:"32px Segoe UI,Helvetica",fill:"#ffffff",align:"center",shadowColor:"rgba(0,0,0,0.5)",shadowOffsetX:3,shadowOffsetY:3,shadowBlur:1};if(i.sprite.txtLabel=game.add.text(i.pos[0]-i.width/2,i.pos[1]-i.height/3-25,i.name,m),i.sprite.txtLabel.alpha=0,i.animations)for(var g in i.animations)i.sprite.animList.push([i.animations[g],g]);if(i.framesIdle){var u=i.sprite.animations.add("idleMove",i.framesIdle);i.sprite.randLoop=game.rnd.integerInRange(20,40),d.onLoop.add(n,this),u.onComplete.add(o,this)}i.sprite.animations.play("idle",7,!0),i.sprite.inputEnabled=!0,i.sprite.events.onInputDown.add(function(t){var n=t.key.replace("spr","");a(e,t,n),game.add.tween(t.txtLabel).to({alpha:0},500,Phaser.Easing.Quadratic.InOut,!0)},this),i.sprite.events.onInputOver.add(function(e){document.querySelector("body").classList.add("hand"),game.learnMore&&game.add.tween(e.txtLabel).to({alpha:1},500,Phaser.Easing.Quadratic.InOut,!0)},this),i.sprite.events.onInputOut.add(function(e){document.querySelector("body").classList.remove("hand"),game.add.tween(e.txtLabel).to({alpha:0},500,Phaser.Easing.Quadratic.InOut,!0)},this)}var c=game.add.sprite(60,60,"btnBack");c.anchor.setTo(.5,.5),c.inputEnabled=!0,c.events.onInputOver.add(function(){c.angle-=25,document.querySelector("body").classList.add("hand")},this),c.events.onInputOut.add(function(){c.angle+=25,document.querySelector("body").classList.remove("hand")},this),c.events.onInputDown.add(function(){s.to("menu")},this);var p=game.add.sprite(1380,840,"btnAsk");p.anchor.setTo(.5,.5),p.inputEnabled=!0,p.events.onInputOver.add(function(){p.angle+=15,document.querySelector("body").classList.add("hand")},this),p.events.onInputOut.add(function(){p.angle-=15,document.querySelector("body").classList.remove("hand")},this),p.events.onInputDown.add(function(){game.fx.click.play(),game.learnMore?(game.learnMore=!1,document.querySelector("body").classList.remove("ask")):(game.learnMore=!0,document.querySelector("body").classList.add("ask"))})},update:function(){1==game.music.fade&&game.music.volume>0&&(game.music.volume-=.002)}},t(e.name),game.state.add(e.name,i[e.name])}),init=!0)}},request.onerror=function(){},request.send()}},i.preload=function(e){this.game=e},i.preload.prototype={preload:function(){if(console.log("Preloading..."),this.loadingBar=this.add.sprite(this.game.world.centerX,this.game.world.centerY,"logoLoad"),this.loadingBar.anchor.setTo(.5,.5),game.add.tween(this.loadingBar).to({y:game.world.centerY+20,alpha:.5},2e3,Phaser.Easing.Quadratic.InOut,!0,0,1e3,!0),0===r)game.load.image("logo","assets/images/bg/logo.png"),game.load.image("bgMenu","assets/images/bg/bg_test2.jpg"),game.load.image("bgMenuT","assets/images/bg/bg_test2_t.jpg"),game.load.image("bgEmergent","assets/images/bg/bg_canopy.jpg"),game.load.audio("introSong",["assets/sfx/song_bassa.mp3","assets/sfx/song_bassa.ogg"]),game.load.audio("click",["assets/sfx/click.wav"]),r="menu";else{console.log("Preloading "+r+" files...");var e=game.jungle[r];for(var a in e.creatures)if(game.load.spritesheet("spr"+a,"assets/images/animals/"+a+".png",e.creatures[a].width,e.creatures[a].height),e.creatures[a].animations)for(var t in e.creatures[a].animations)game.load.spritesheet("spr"+a+t,"assets/images/animals/"+a+"_"+t+".png",e.creatures[a].animations[t].size[0],e.creatures[a].animations[t].size[1]);game.load.audio("amb",["assets/"+e.sounds.background]),game.load.audio("sfx",["assets/"+e.sounds.effects]),game.jungle.sfx=game.add.audio("sfx");for(var n in e.sounds.markers)game.jungle.sfx.addMarker(n,e.sounds.markers[n][0],e.sounds.markers[n][1])}},create:function(){game.state.start(r)}},i.menu=function(e){this.game=e},i.menu.prototype={preload:function(){},create:function(){game.music=game.add.audio("introSong",1,!0),bgMenu=game.add.sprite(0,0,"bgMenu"),bgMenu.inputEnabled=!0,bgMenu.events.onInputDown.add(function(){document.getElementById("notice").classList.add("active")},this),sprLogo=game.add.sprite(game.world.centerX,game.world.centerY-10,"logo"),sprLogo.anchor.setTo(.5,.5),game.add.tween(sprLogo).to({y:game.world.centerY+30},2e3,Phaser.Easing.Quadratic.InOut,!0,0,1e3,!0),game.music.play("",0,.25,!0);{var e="Click anywhere to continue",a={font:"38px Segoe UI,Helvetica",fill:"#ffffff",align:"center"};game.add.text(game.world.centerX-200,850,e,a)}},update:function(){1==game.music.fade&&game.music.volume>0&&(game.music.volume-=.002)}},game.state.add("boot",i.boot,!0),game.state.add("preload",i.preload,!1),game.state.add("menu",i.menu,!1),document.querySelector("#notice button").addEventListener("click",function(){document.getElementById("notice").classList.remove("active"),r="emergent",s.to("preload"),game.music.fade=!0})};